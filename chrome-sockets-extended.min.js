(function(n){chrome.socketsExtended={tcp:{},udp:{},tcpServer:{}};(function(){function a(){}function b(a,b){for(var d=a.length;d--;)if(a[d].listener===b)return d;return-1}function d(a){return function(){return this[a].apply(this,arguments)}}var c=a.prototype,e=this,f=e.EventEmitter;c.getListeners=function(a){var b,d,c=this._getEvents();if(a instanceof RegExp)for(d in b={},c)c.hasOwnProperty(d)&&a.test(d)&&(b[d]=c[d]);else b=c[a]||(c[a]=[]);return b};c.flattenListeners=function(a){var b,d=[];for(b=
0;b<a.length;b+=1)d.push(a[b].listener);return d};c.getListenersAsObject=function(a){var b,d=this.getListeners(a);return d instanceof Array&&(b={},b[a]=d),b||d};c.addListener=function(a,d){var c,h=this.getListenersAsObject(a),e="object"==typeof d;for(c in h)h.hasOwnProperty(c)&&-1===b(h[c],d)&&h[c].push(e?d:{listener:d,once:!1});return this};c.on=d("addListener");c.addOnceListener=function(a,b){return this.addListener(a,{listener:b,once:!0})};c.once=d("addOnceListener");c.defineEvent=function(a){return this.getListeners(a),
this};c.defineEvents=function(a){for(var b=0;b<a.length;b+=1)this.defineEvent(a[b]);return this};c.removeListener=function(a,d){var c,h,e=this.getListenersAsObject(a);for(h in e)e.hasOwnProperty(h)&&(c=b(e[h],d),-1!==c&&e[h].splice(c,1));return this};c.off=d("removeListener");c.addListeners=function(a,b){return this.manipulateListeners(!1,a,b)};c.removeListeners=function(a,b){return this.manipulateListeners(!0,a,b)};c.manipulateListeners=function(a,b,d){var c,e,f=a?this.removeListener:this.addListener;
a=a?this.removeListeners:this.addListeners;if("object"!=typeof b||b instanceof RegExp)for(c=d.length;c--;)f.call(this,b,d[c]);else for(c in b)b.hasOwnProperty(c)&&(e=b[c])&&("function"==typeof e?f.call(this,c,e):a.call(this,c,e));return this};c.removeEvent=function(a){var b,d=typeof a,c=this._getEvents();if("string"===d)delete c[a];else if(a instanceof RegExp)for(b in c)c.hasOwnProperty(b)&&a.test(b)&&delete c[b];else delete this._events;return this};c.removeAllListeners=d("removeEvent");c.emitEvent=
function(a,b){var d,c,e,f,g=this.getListenersAsObject(a);for(e in g)if(g.hasOwnProperty(e))for(c=g[e].length;c--;)d=g[e][c],!0===d.once&&this.removeListener(a,d.listener),f=d.listener.apply(this,b||[]),f===this._getOnceReturnValue()&&this.removeListener(a,d.listener);return this};c.trigger=d("emitEvent");c.emit=function(a){var b=Array.prototype.slice.call(arguments,1);return this.emitEvent(a,b)};c.setOnceReturnValue=function(a){return this._onceReturnValue=a,this};c._getOnceReturnValue=function(){return this.hasOwnProperty("_onceReturnValue")?
this._onceReturnValue:!0};c._getEvents=function(){return this._events||(this._events={})};a.noConflict=function(){return e.EventEmitter=f,a};"function"==typeof define&&define.amd?define(function(){return a}):"object"==typeof module&&module.exports?module.exports=a:this.EventEmitter=a}).call(this);var e={tcp:{},udp:{},tcpServer:{}};chrome.socketsExtended.tcp.open=function(a,b){chrome.sockets.tcp.create(a,function(a){var c=new k(a.socketId);c.on("closed",l);e.tcp[a.socketId]=c;b(c)})};chrome.socketsExtended.tcpServer.open=
function(a,b){chrome.sockets.tcpServer.create(a,function(a){var c=new m(a.socketId);c.on("closed",l);e.tcpServer[a.socketId]=c;b(c)})};chrome.socketsExtended.udp.open=function(a,b){chrome.sockets.udp.create(a,function(a){var c=new g(a.socketId);c.on("closed",l);e.udp[a.socketId]=c;b(c)})};chrome.socketsExtended.tcp.closeAll=function(a){chrome.sockets.tcp.getSockets(function(b){for(var d=0;d<b.length;d++)chrome.sockets.tcp.close(b[d].socketId);a&&a()})};chrome.socketsExtended.udp.closeAll=function(a){chrome.sockets.udp.getSockets(function(b){for(var d=
0;d<b.length;d++)chrome.sockets.udp.close(b[d].socketId);a&&a()})};chrome.socketsExtended.tcpServer.closeAll=function(a){chrome.sockets.tcpServer.getSockets(function(b){for(var d=0;d<b.length;d++)chrome.sockets.tcpServer.close(b[d].socketId);a&&a()})};var l=function(){e[this.type][this.socketId]=null;delete e[this.type][this.socketId];this.removeAllListeners()};chrome.sockets.tcp.onReceive.addListener(function(a){var b=a.socketId;e.tcp[b]&&e.tcp[b].emit("receive",a)});chrome.sockets.tcp.onReceiveError.addListener(function(a){a&&
a.socketId&&e.tcp[a.socketId]&&e.tcp[a.socketId].emit("receiveError",a.resultCode)});chrome.sockets.udp.onReceive.addListener(function(a){e.udp[a.socketId]&&e.udp[a.socketId].emit("receive",a)});chrome.sockets.udp.onReceiveError.addListener(function(a){a&&a.socketId&&e.udp[a.socketId]&&e.udp[a.socketId].emit("receiveError",a.resultCode)});chrome.sockets.tcpServer.onAccept.addListener(function(a){if(e.tcpServer[a.socketId]){var b=new k(a.clientSocketId);b.on("closed",l);e.tcp[a.clientSocketId]=b;e.tcpServer[a.socketId].emit("accept",
b)}});chrome.sockets.tcpServer.onAcceptError.addListener(function(a){a&&a.socketId&&e.udp[a.socketId]&&e.tcpServer[a.socketId].emit("receiveError",a.resultCode)});var f=function(a){EventEmitter.call(this);this._api=chrome.sockets[a];this.type=a};f.prototype=Object.create(EventEmitter.prototype);f.prototype.update=function(a,b){this._api.update(this.socketId,a,b)};f.prototype.setPaused=function(a,b){this._api.setPaused(this.socketId,a,b)};f.prototype.close=function(a){var b=this;this._api.close(this.socketId,
function(){b.emit("closed")})};f.prototype.getInfo=function(a){this._api.getInfo(this.socketId,a)};var k=function(a){f.call(this,"tcp");this.socketId=a};k.prototype=Object.create(f.prototype);k.prototype.setKeepAlive=function(a,b,d){chrome.sockets.tcp.setKeepAlive(this.socketId,a,b,d)};k.prototype.setNoDelay=function(a,b){chrome.sockets.tcp.setNoDelay(this.socketId,a,b)};k.prototype.connect=function(a,b,d){chrome.sockets.tcp.connect(this.socketId,a,b,d)};k.prototype.disconnect=function(a){chrome.sockets.tcp.disconnect(this.socketId,
a)};k.prototype.send=function(a,b){chrome.sockets.tcp.send(this.socketId,a,b)};var g=function(a){f.call(this,"udp");this.socketId=a};g.prototype=Object.create(f.prototype);g.prototype.bind=function(a,b,d){chrome.sockets.udp.bind(this.socketId,a,b,d)};g.prototype.send=function(a,b,d,c){chrome.sockets.udp.send(this.socketId,a,b,d,c)};g.prototype.joinGroup=function(a,b){chrome.sockets.udp.joinGroup(this.socketId,a,b)};g.prototype.leaveGroup=function(a,b){chrome.sockets.udp.leaveGroup(this.socketId,a,
b)};g.prototype.setMulticastTimeToLive=function(a,b){chrome.sockets.udp.setMulticastTimeToLive(this.socketId,a,b)};g.prototype.setMulticastLoopbackMode=function(a,b){chrome.sockets.udp.setMulticastLoopbackMode(this.socketId,a,b)};g.prototype.getJoinedGroups=function(a){chrome.sockets.udp.getJoinedGroups(this.socketId,a)};var m=function(a){f.call(this,"tcpServer");this.socketId=a};m.prototype=Object.create(f.prototype);m.prototype.listen=function(a,b,d){chrome.sockets.tcpServer.listen(this.socketId,
a,b,d)}})(window);